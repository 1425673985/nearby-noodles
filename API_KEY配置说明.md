# 高德地图API Key配置说明

## 错误原因

当前出现的 `INVALID_USER_KEY` 错误是因为高德地图API Key未正确配置。

## 解决步骤

### 第一步：获取高德地图API Key

1. **访问高德开放平台**
   - 打开：https://console.amap.com/
   - 如果还没有账号，请先注册

2. **创建应用**
   - 登录后，点击"控制台" -> "应用管理" -> "我的应用"
   - 点击"创建新应用"
   - 填写应用名称（如：附近面馆小程序）
   - 应用类型选择"微信小程序"

3. **添加Key**
   - 在创建的应用中，点击"添加Key"
   - Key名称：填写一个名称（如：附近面馆）
   - 服务平台：选择"微信小程序"
   - 绑定：填写你的微信小程序AppID（在project.config.json中可以找到，如：wx8038653682d43c47）
   - 点击"提交"

4. **获取Key**
   - 创建成功后，你会看到一个Key（一串字符串）
   - 复制这个Key

### 第二步：配置API Key

1. **打开配置文件**
   - 打开项目中的 `utils/config.js` 文件

2. **替换API Key**
   - 找到这一行：
     ```javascript
     AMAP_KEY: 'your-amap-key', // 请替换为你的高德地图API Key
     ```
   - 将 `'your-amap-key'` 替换为你刚刚复制的Key，例如：
     ```javascript
     AMAP_KEY: 'a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6',
     ```

3. **保存文件**
   - 保存配置文件
   - 在微信开发者工具中重新编译

### 第三步：配置服务器域名（重要）

由于微信小程序的网络安全限制，需要配置request合法域名：

1. **登录微信公众平台**
   - 打开：https://mp.weixin.qq.com/
   - 使用你的小程序账号登录

2. **配置服务器域名**
   - 进入：开发 -> 开发管理 -> 开发设置
   - 找到"服务器域名" -> "request合法域名"
   - 点击"修改"
   - 添加域名：`https://restapi.amap.com`
   - 点击"保存"

3. **注意事项**
   - 需要小程序管理员扫码确认
   - 如果是个人开发者或测试号，可能无法配置，建议使用服务器代理方案

### 第四步：验证配置

1. 重新编译小程序
2. 在控制台查看是否还有 `INVALID_USER_KEY` 错误
3. 如果配置正确，应该可以正常搜索到面馆了

## 备选方案：使用服务器代理

如果无法配置request合法域名（例如使用测试号），可以使用服务器代理方案：

1. **部署服务器代理**
   - 使用项目根目录下的 `server-example.js` 作为参考
   - 在你的服务器上部署这个代理接口
   - 在 `utils/config.js` 中配置服务器地址

2. **修改代码使用代理**
   - 在 `pages/index/index.js` 中，将 `searchNearbyRestaurants` 改为 `searchNearbyRestaurantsByProxy`

3. **配置代理域名**
   - 在微信公众平台配置你的服务器域名

## 常见问题

### Q: 为什么需要配置API Key？
A: 高德地图API需要身份验证，API Key用于标识你的应用身份。

### Q: API Key安全吗？
A: API Key应该妥善保管，不要提交到公开的代码仓库。建议使用服务器代理方案，将API Key放在服务器端。

### Q: 配置域名后还是不工作？
A: 确保：
- API Key正确无误
- 小程序AppID与高德平台配置的一致
- 域名配置已保存并生效
- 重新编译了小程序

### Q: 测试号可以配置域名吗？
A: 测试号通常无法配置服务器域名，建议使用服务器代理方案。
