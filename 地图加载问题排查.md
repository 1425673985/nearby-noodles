# 地图加载问题排查

## 可能的原因

静态地图图片一直显示"加载地图中..."可能有以下原因：

### 1. 域名未配置（最常见）

**需要在微信公众平台配置两个域名：**

#### request合法域名（用于API调用）
- `https://apis.map.qq.com`

#### downloadFile合法域名（用于下载图片，重要！）
- `https://apis.map.qq.com`

**配置步骤：**
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入：开发 -> 开发管理 -> 开发设置 -> 服务器域名
3. 在"request合法域名"中添加：`https://apis.map.qq.com`
4. **在"downloadFile合法域名"中添加：`https://apis.map.qq.com`**（这个很重要！）

### 2. API Key问题

- 检查API Key是否正确
- 确认API Key是否开启了WebServiceAPI服务
- 确认小程序AppID是否已添加到授权列表

### 3. URL编码问题

静态地图API的markers参数可能包含特殊字符，需要进行URL编码（已在代码中添加）

### 4. 查看控制台日志

在微信开发者工具的控制台中查看：
- "生成的静态地图URL：" - 查看生成的URL是否正确
- "地图图片加载失败" - 查看是否有错误信息

## 调试步骤

1. **查看控制台日志**
   - 打开微信开发者工具的控制台
   - 查看是否有"生成的静态地图URL："的日志
   - 复制URL，在浏览器中打开，看是否能正常显示图片

2. **检查域名配置**
   - 确认request合法域名已配置
   - **确认downloadFile合法域名已配置**（这个很关键！）

3. **测试API Key**
   - 在浏览器中直接访问生成的静态地图URL
   - 如果能正常显示，说明API Key没问题
   - 如果显示错误，检查API Key配置

## 常见错误

1. **"url not in domain list"**
   - 域名未配置或配置错误
   - 需要配置downloadFile合法域名

2. **"INVALID_KEY"**
   - API Key无效或未授权
   - 检查API Key配置

3. **图片一直加载**
   - 通常是域名未配置
   - 优先检查downloadFile合法域名
