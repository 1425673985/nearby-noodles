# 腾讯地图集成说明

## 已完成的工作

1. ✅ 创建腾讯地图 SDK 文件 (`libs/qqmap-wx-jssdk.js`)
2. ✅ 配置腾讯地图 API Key (`utils/config.js`)
3. ✅ 集成腾讯地图 search 接口
4. ✅ 删除模拟数据代码
5. ✅ 适配腾讯地图返回的数据格式
6. ✅ 实现实时搜索和列表更新

## API Key 配置

API Key 已配置在 `utils/config.js` 文件中：
```javascript
TENCENT_MAP_KEY: 'DPUBZ-4HN3L-BTNPE-EW2W5-C4BXV-EOFHZ'
```

## 需要配置的域名

在微信公众平台配置 request 合法域名：
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入：开发 -> 开发管理 -> 开发设置 -> 服务器域名
3. 在"request合法域名"中添加：`https://apis.map.qq.com`

## 功能说明

### 搜索功能
- 搜索半径：3000米（3km）
- 搜索关键词：面馆
- 搜索接口：腾讯地图 place/v1/search API
- 返回结果：最多20条结果，按距离排序

### 数据格式
腾讯地图API返回的数据字段：
- `title`: 面馆名称
- `address`: 地址
- `location`: 位置信息（纬度,经度）
- `_distance`: 距离（米）
- `_rating`: 评分（如果有）
- `tel`: 电话
- `photo`: 图片数组

### 代码结构

**主要文件：**
- `libs/qqmap-wx-jssdk.js` - 腾讯地图 SDK 封装
- `pages/index/index.js` - 主页面逻辑（已集成搜索功能）
- `utils/config.js` - 配置文件（包含API Key）

**关键函数：**
- `searchNearbyRestaurants()` - 搜索附近面馆
- `processRestaurantData()` - 处理腾讯地图返回的数据格式
- `changeRestaurant()` - 切换显示的面馆
- `openNavigation()` - 打开导航

## 使用说明

1. 确保已配置 request 合法域名
2. 在微信开发者工具中编译运行
3. 授权位置权限
4. 自动搜索附近3km内的面馆
5. 可以点击"换一家面馆"按钮切换显示
6. 可以点击"开始导航"按钮打开地图导航

## 注意事项

1. **API Key权限**：确保在腾讯位置服务控制台中，该Key已开启WebServiceAPI服务
2. **小程序AppID**：确保在腾讯位置服务控制台中，已将小程序AppID添加到授权列表
3. **坐标系**：使用的是GCJ02坐标系（腾讯地图标准）
4. **图片资源**：如果没有图片，会使用默认占位图 `/images/default-restaurant.jpg`

## 测试

如果搜索失败，请检查：
1. API Key是否正确
2. request合法域名是否已配置
3. 控制台是否有错误信息
4. 网络连接是否正常
5. 位置权限是否已授权
